<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¯æ—¥ä»»åŠ¡ç®¡ç†å™¨</title>
    <style>
        /* åŸºç¡€æ ·å¼ (ä½ å¯å¤§å¹…ç¾åŒ–) */
        body { font-family: sans-serif; margin: 20px; }
        .day-container { border: 1px solid #ccc; margin-bottom: 15px; padding: 15px; border-radius: 5px; }
        .date-header { font-weight: bold; margin-bottom: 10px; cursor: pointer; }
        .task-item { display: flex; align-items: center; margin-bottom: 5px; }
        .task-item input[type="checkbox"] { margin-right: 8px; }
        .task-item input:checked + input { color: #999; }
        button { margin-right: 5px; margin-top: 10px; }
    </style>
</head>
<body>
    <h1>æ¯æ—¥ä»»åŠ¡ç®¡ç†å™¨</h1>
    <button id="addTaskBtn">+ æ·»åŠ æ–°ä»»åŠ¡</button>
    <button id="copyYesterdayBtn">ğŸ“‹ å¤åˆ¶æ˜¨å¤©çš„æœªå®Œæˆä»»åŠ¡</button>
    <hr>
    <!-- å½“å¤©çš„ä»»åŠ¡å®¹å™¨ -->
    <div id="todayContainer"></div>

    <script>
        // å·¥å…·å‡½æ•°ï¼šè·å–â€œYYYY-MM-DDâ€æ ¼å¼çš„æ—¥æœŸå­—ç¬¦ä¸²
        function getDateStr(dateObj) {
            return dateObj.toISOString().split('T')[0];
        }

        // 1. åˆå§‹åŒ–ï¼šè·å–ä»Šå¤©å’Œæ˜¨å¤©çš„æ—¥æœŸé”®
        const todayStr = getDateStr(new Date());
        const yesterday = new Date();
        yesterday.setDate(yesterday.getDate() - 1);
        const yesterdayStr = getDateStr(yesterday);

        // 2. åŠ è½½æˆ–åˆå§‹åŒ–ä»Šå¤©çš„ä»»åŠ¡åˆ—è¡¨
        let tasks = JSON.parse(localStorage.getItem(todayStr)) || [];
        renderTasks();

        // 3. æ¸²æŸ“ä»»åŠ¡åˆ—è¡¨çš„å‡½æ•°
        function renderTasks() {
            const container = document.getElementById('todayContainer');
            container.innerHTML = `<div class="date-header">ğŸ“… ä»Šå¤© (${todayStr})</div>`;
            tasks.forEach((task, index) => {
                const taskElem = document.createElement('div');
                taskElem.className = 'task-item';
                taskElem.innerHTML = `
                    <input type="checkbox" ${task.completed ? 'checked' : ''} data-index="${index}">
                    <input type="text" value="${task.text}" data-index="${index}" style="border:none; flex-grow:1; margin-left:5px;">
                    <button class="delete-btn" data-index="${index}">åˆ é™¤</button>
                `;
                const textSpan = taskElem.querySelector('input[type="text"]');
                const checkbox = taskElem.querySelector('input[type="checkbox"]');
                if(task.completed) textSpan.classList.add('completed');
                container.appendChild(taskElem);
            });
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem(todayStr, JSON.stringify(tasks));
        }

        // 4. äº‹ä»¶å§”æ‰˜ï¼šå¤„ç†å¤é€‰æ¡†å˜åŒ–ã€æ–‡æœ¬ä¿®æ”¹å’Œåˆ é™¤
        document.body.addEventListener('change', function(e) {
            if(e.target.type === 'checkbox') {
                const index = e.target.dataset.index;
                tasks[index].completed = e.target.checked;
                // è§¦å‘é‡æ–°æ¸²æŸ“ä»¥æ›´æ–°æ–‡æœ¬æ ·å¼
                renderTasks();
            }
        });

        document.body.addEventListener('click', function(e) {
            if(e.target.classList.contains('delete-btn')) {
                const index = e.target.dataset.index;
                tasks.splice(index, 1);
                renderTasks();
            }
        });

        // 5. æ·»åŠ æ–°ä»»åŠ¡æŒ‰é’®
        document.getElementById('addTaskBtn').addEventListener('click', function() {
            tasks.push({text: "æ–°ä»»åŠ¡", completed: false});
            renderTasks();
        });

        // 6. â€œå¤åˆ¶æ˜¨å¤©â€æŒ‰é’®
        document.getElementById('copyYesterdayBtn').addEventListener('click', function() {
            const yesterdayTasks = JSON.parse(localStorage.getItem(yesterdayStr)) || [];
            const unfinishedTasks = yesterdayTasks.filter(task => !task.completed);
            if(unfinishedTasks.length === 0) {
                alert('æ˜¨å¤©æ²¡æœ‰æœªå®Œæˆçš„ä»»åŠ¡ã€‚');
                return;
            }
            // å°†æœªå®Œæˆçš„ä»»åŠ¡å¤åˆ¶åˆ°ä»Šå¤©ï¼ˆå¯é¿å…å®Œå…¨é‡å¤ï¼‰
            unfinishedTasks.forEach(task => {
                // å¯é€‰ï¼šåœ¨ä»»åŠ¡æ–‡æœ¬åæ·»åŠ æ ‡è®°
                tasks.push({text: task.text + " (æ¥è‡ªæ˜¨å¤©)", completed: false});
            });
            renderTasks();
            alert(`å·²æ·»åŠ  ${unfinishedTasks.length} é¡¹æ¥è‡ªæ˜¨å¤©çš„æœªå®Œæˆä»»åŠ¡ã€‚`);
        });
    </script>
</body>
</html>
